postgres:
  image: postgres:9.5
  environment:
    - POSTGRES_USER="{{ sentry_db_user }}"
    - POSTGRES_PASSWORD="{{ sentry_db_password }}"
    - POSTGRES_DB="{{ sentry_db_name }}"
  volumes:
    - {{ docker_data_path }}/{{ sentry_dir }}/postgres:/var/lib/postgresql/data
redis:
  image: redis:3.2
beat: &DEFAULT
  image: sentry:8.5
  command: "sentry run cron --pidfile=/tmp/celerybeat-sentry.pid"
  restart: always
  privileged: true
  environment:
    - POSTGRES_USER="{{ sentry_db_user }}"
    - POSTGRES_PASSWORD="{{ sentry_db_password }}"
    - POSTGRES_DB="{{ sentry_db_name }}"
    - SENTRY_SECRET_KEY="{{ sentry_secret_key }}"
    - SENTRY_EMAIL_USER="{{ sentry_email_user }}"
    - SENTRY_EMAIL_PASSWORD="{{ sentry_email_password }}"
    - SENTRY_EMAIL_HOST="{{ sentry_email_host }}"
    - SENTRY_SERVER_EMAIL="{{ sentry_server_email }}"
  volumes:
    - {{ docker_data_path }}/{{ sentry_dir }}/files:/var/lib/sentry/files
  links:
    - redis
    - postgres
worker:
  <<: *DEFAULT
  command: "sentry run worker"
web:
  <<: *DEFAULT
  command: "sentry run web"
  ports:
    - "{{ sentry_local_port }}:9000"
