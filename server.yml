---
# Basic server setup.
- hosts: all
  remote_user: root
  become: true
  roles:
    - { role: 'system_common' }
    - { role: 'docker_host' }

- hosts: legacy_hosting
  remote_user: root
  become: true
  roles:
    - { role: 'nginx', tags: ['nginx']  }
    - { role: 'nodejs' }
    - { role: 'redis', tags: ['redis'] }
    - { role: 'postgresql', tags: ['postgres'] }

# apps user environment.
- hosts: legacy_hosting
  remote_user: root
  become: true
  become_user: '{{ apps_user }}'
  roles:
    - { role: 'rbenv' }
